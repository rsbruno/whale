<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/hostel/guests/index.css">
    <title>Document</title>
</head>

<body>
    <section>
        <div>
            <span>show</span>
            <select id="counts" onchange="showDataCount()">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>FirstName</th>
                    <th>LastName</th>
                    <th>Email</th>
                    <th>Address</th>
                </tr>
            </thead>
            <tbody id="teste">
            </tbody>
        </table>
        <footer>
            <div class="dv-footer-table">
                <div>
                    <span>
                        showing
                        <strong id='atual-page'>1</strong>
                        to
                        <strong id='limit'>10</strong>
                        of
                        <strong id="total">23</strong>
                        entries
                    </span>
                </div>
                <div class="dv-wrapper-constrols">
                    <button onclick="previous();">Previous</button>
                    <div class="constrols" id="controls"></div>
                    <button onclick="next();">Next</button>
                </div>
            </div>
        </footer>

    </section>

</body>



<script>
    let pagesNum = 0,
        atualPage = 1,
        guests = [],
        limMax = 10


    async function buscar() {
        const response = await fetch("../scripts/utils/guests.json")
        const guests = await response.json()
        return guests
    }


    function showDataCount() {
        const count = document.getElementById("counts")
        unMountTable("teste")

        limMax = parseInt(count.value)

        unMountControls()

        renderTable(guests, "teste", atualPage, limMax)

        renderButtons("controls", pagesNum, atualPage)
    }

    function previous() {
        if (atualPage != 1) {
            unMountTable("teste")
            renderTable(guests, "teste", atualPage - 1, limMax)
        }
    }

    function next() {
        if (atualPage < pagesNum) {
            unMountTable("teste")
            renderTable(guests, "teste", atualPage + 1, limMax)
        }
    }

    function renderProps() {
        document.getElementById("atual-page").innerHTML = `${(atualPage * limMax) - (limMax - 1)}`
        document.getElementById("limit").innerHTML = `${limMax}`
        document.getElementById("total").innerHTML = `${guests.length}`

    }

    function changeButton(btn) {
        const hasClass = document.getElementsByClassName("is-actived")
        if (hasClass.length > 0)
            hasClass[0].classList.remove("is-actived")
        const button = document.getElementById(btn)
        if (button)
            button.classList.add("is-actived")
    }

    function unMountControls() {
        for (let i = 1; i <= pagesNum; i++) {
            const button = document.getElementById(`btn${i}`)
            if (button)
                button.remove()
        }
    }

    function unMountTable(nameElem) {
        for (let i = ((atualPage - 1) * limMax); i < atualPage * limMax; i++) {
            const html = document.getElementById(`${nameElem}-${i}`)
            if (html)
                html.remove()
        }
    }

    function renderButtons(nameElem, qndt, atualPage) {
        for (let i = 1; i <= qndt; i++) {
            const html = document.getElementById(nameElem)
            const node = document.createElement("button");
            node.id = `btn${i}`
            node.onclick = function() {
                unMountTable("teste")
                renderTable(guests, "teste", i, limMax)
            };
            var textnode = document.createTextNode(i);

            node.appendChild(textnode);
            html.append(node);

        }
        changeButton(`btn${atualPage}`)
    }

    function renderTable(array, nameElem, page = 1, max = limMax) {
        if (array.length > 0) {
            atualPage = page;
            const html = document.getElementById(nameElem)

            pagesNum = (Math.ceil(array.length / max))

            const teto = (page * max)
            const lim = teto > array.length ? array.length : teto

            for (let i = ((page - 1) * max); i < lim; i++) {
                const node = document.createElement("tr");
                node.id = `${nameElem}-${i}`

                let td = node.insertCell()
                td.appendChild(document.createTextNode(array[i].id));


                td = node.insertCell()
                td.appendChild(document.createTextNode(array[i].phoneNumber));

                td = node.insertCell()
                td.appendChild(document.createTextNode(array[i].firstName));

                td = node.insertCell()
                td.appendChild(document.createTextNode(array[i].lastName));

                td = node.insertCell()
                td.appendChild(document.createTextNode(array[i].emailAddress));

                html.append(node);

            }
            renderProps()
            changeButton(`btn${page}`)

        }
    }


    async function main() {
        guests = await buscar()
        renderTable(guests, "teste", 1, limMax)
        renderButtons("controls", pagesNum, atualPage)
    }

    main()
</script>

</html>